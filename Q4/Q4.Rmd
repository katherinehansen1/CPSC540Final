---
title: "Q4"
author: "Hawkins_Kelsey"
date: "`r Sys.Date()`"
output: pdf_document
---

# Based on the flight phase ("Climb", "Landing Roll", "Approach", "Take-off run"), which phase is correlated with the largest average number of bird strikes? Is there a casual relationship between flight phase and bird strikes?

# Preliminary Analysis

```{r setup, include=FALSE, echo = FALSE}
# Load libraries
library(tidyverse)
library(ggdag)
library(rstanarm)
library(bayesplot)
library(dagitty)

# Load data
data <- read.csv("Bird_strikes.csv", stringsAsFactors = TRUE)

# Replace NAs with 0
data[is.na(data)] <- 0

```

## Summary Overview
```{r overview, include = TRUE, echo = FALSE}
# Summarize bird strikes by flight phase
bird_strikes_summary <- data %>%
  group_by(FlightPhase) %>%
  summarise(
    MeanStrikes = mean(NumberStruckActual, na.rm = TRUE),
    VarianceStrikes = var(NumberStruckActual, na.rm = TRUE),
    Count = n()
  )

# Print the summary
print(bird_strikes_summary)

# Bar plot of mean bird strikes by flight phase
ggplot(bird_strikes_summary, aes(x = FlightPhase, y = MeanStrikes, fill = FlightPhase)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Average Bird Strikes by Flight Phase",
    x = "Flight Phase",
    y = "Average Number of Bird Strikes"
  ) +
  theme_minimal()

```

## DAG
```{r DAG, include = TRUE, echo = FALSE}
# Construct DAG
dag <- dagitty("
dag {
  AircraftType -> NumberStruckActual
  WeatherConditions -> NumberStruckActual
  TimeOfDay -> NumberStruckActual
  FlightPhase -> NumberStruckActual
}
")

# Plot the DAG
ggdag(dag) +
  theme_minimal() +
  labs(title = "DAG: Confounding Variables for Bird Strikes")

```

# Bayesian Parameter Estimation + Causal Inference
```{r bayesianParamEstimation, echo = FALSE, include = TRUE}
# Fit Bayesian Poisson regression
bayesian_model <- stan_glm(
  NumberStruckActual ~ FlightPhase,
  data = data,
  family = poisson(link = "log"),
  prior = normal(0, 2.5),
  prior_intercept = normal(0, 5),
  chains = 4, iter = 2000
)

# Summarize model output
print(summary(bayesian_model))

# Extract posterior intervals
posterior_intervals <- posterior_interval(bayesian_model, prob = 0.95)
print(posterior_intervals)

# Plot posterior distributions
mcmc_areas(
  as.matrix(bayesian_model),
  pars = c("(Intercept)", 
           "FlightPhaseClimb", 
           "FlightPhaseLanding Roll", 
           "FlightPhaseTake-off run")
) +
  labs(title = "Posterior Distributions of Flight Phase Effects")

# Posterior predictive checks
pp_check(bayesian_model, plotfun = "dens_overlay") +
  labs(title = "Posterior Predictive Check")

```


### Results:

